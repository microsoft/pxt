class Image {
    public height: number;
    public width: number;
    public data: number[];
    constructor(width: number, data: number[]) {
        //super();
        this.width = width
        this.data = data
        this.height = (this.data.length / this.width) | 0
    }

    public getStartingSquare(width: number, height: number, offset: number = 0): number[][] {
        return new Array(height).fill(null).map((empty, yindex) => {
            return new Array(width).fill(null).map((empty, xindex) => this.get(xindex + offset, yindex) ? 1 : 0)
        })
    }

    public get(x: number, y: number): number {
        x = x | 0;
        y = y | 0;
        if (x < 0 || x >= this.width || y < 0 || y >= this.height) return 0;
        return this.data[y * this.width + x];
    }
    public set(x: number, y: number, v: number) {
        x = x | 0;
        y = y | 0;
        if (x < 0 || x >= this.width || y < 0 || y >= this.height) return;
        this.data[y * this.width + x] = Math.max(0, Math.min(255, v));
    }
    public shiftLeft(cols: number) {
        cols = cols | 0;
        for (let x = 0; x < this.width; ++x)
            for (let y = 0; y < this.height; ++y)
                this.set(x, y, x < this.width - cols ? this.get(x + cols, y) : 0);
    }

    public shiftRight(cols: number) {
        cols = cols >> 0;
        for (let x = this.width - 1; x >= 0; --x)
            for (let y = 0; y < this.height; ++y)
                this.set(x, y, x >= cols ? this.get(x - cols, y) : 0);
    }
    public copyTo(xSrcIndex: number, length: number, target: Image, xTargetIndex: number): void {
        xSrcIndex = xSrcIndex | 0;
        length = length | 0;
        xTargetIndex = xTargetIndex | 0;
        for (let x = 0; x < length; x++) {
            for (let y = 0; y < this.height; y++) {
                let value = this.get(xSrcIndex + x, y);
                target.set(xTargetIndex + x, y, value);
            }
        }
    }
}

function createImage(width: number): Image {
    width = width >> 0;
    return new Image(width, new Array(width * 5));
}

function createInternalImage(width: number): Image {
    width = width >> 0;
    let img = createImage(width)
    return img
}

const FONT_DATA = [0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x8, 0x8, 0x0, 0x8, 0xa, 0x4a, 0x40, 0x0, 0x0, 0xa, 0x5f, 0xea, 0x5f, 0xea, 0xe, 0xd9, 0x2e, 0xd3, 0x6e, 0x19, 0x32, 0x44, 0x89, 0x33, 0xc, 0x92, 0x4c, 0x92, 0x4d, 0x8, 0x8, 0x0, 0x0, 0x0, 0x4, 0x88, 0x8, 0x8, 0x4, 0x8, 0x4, 0x84, 0x84, 0x88, 0x0, 0xa, 0x44, 0x8a, 0x40, 0x0, 0x4, 0x8e, 0xc4, 0x80, 0x0, 0x0, 0x0, 0x4, 0x88, 0x0, 0x0, 0xe, 0xc0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x0, 0x1, 0x22, 0x44, 0x88, 0x10, 0xc, 0x92, 0x52, 0x52, 0x4c, 0x4, 0x8c, 0x84, 0x84, 0x8e, 0x1c, 0x82, 0x4c, 0x90, 0x1e, 0x1e, 0xc2, 0x44, 0x92, 0x4c, 0x6, 0xca, 0x52, 0x5f, 0xe2, 0x1f, 0xf0, 0x1e, 0xc1, 0x3e, 0x2, 0x44, 0x8e, 0xd1, 0x2e, 0x1f, 0xe2, 0x44, 0x88, 0x10, 0xe, 0xd1, 0x2e, 0xd1, 0x2e, 0xe, 0xd1, 0x2e, 0xc4, 0x88, 0x0, 0x8, 0x0, 0x8, 0x0, 0x0, 0x4, 0x80, 0x4, 0x88, 0x2, 0x44, 0x88, 0x4, 0x82, 0x0, 0xe, 0xc0, 0xe, 0xc0, 0x8, 0x4, 0x82, 0x44, 0x88, 0xe, 0xd1, 0x26, 0xc0, 0x4, 0xe, 0xd1, 0x35, 0xb3, 0x6c, 0xc, 0x92, 0x5e, 0xd2, 0x52, 0x1c, 0x92, 0x5c, 0x92, 0x5c, 0xe, 0xd0, 0x10, 0x10, 0xe, 0x1c, 0x92, 0x52, 0x52, 0x5c, 0x1e, 0xd0, 0x1c, 0x90, 0x1e, 0x1e, 0xd0, 0x1c, 0x90, 0x10, 0xe, 0xd0, 0x13, 0x71, 0x2e, 0x12, 0x52, 0x5e, 0xd2, 0x52, 0x1c, 0x88, 0x8, 0x8, 0x1c, 0x1f, 0xe2, 0x42, 0x52, 0x4c, 0x12, 0x54, 0x98, 0x14, 0x92, 0x10, 0x10, 0x10, 0x10, 0x1e, 0x11, 0x3b, 0x75, 0xb1, 0x31, 0x11, 0x39, 0x35, 0xb3, 0x71, 0xc, 0x92, 0x52, 0x52, 0x4c, 0x1c, 0x92, 0x5c, 0x90, 0x10, 0xc, 0x92, 0x52, 0x4c, 0x86, 0x1c, 0x92, 0x5c, 0x92, 0x51, 0xe, 0xd0, 0xc, 0x82, 0x5c, 0x1f, 0xe4, 0x84, 0x84, 0x84, 0x12, 0x52, 0x52, 0x52, 0x4c, 0x11, 0x31, 0x31, 0x2a, 0x44, 0x11, 0x31, 0x35, 0xbb, 0x71, 0x12, 0x52, 0x4c, 0x92, 0x52, 0x11, 0x2a, 0x44, 0x84, 0x84, 0x1e, 0xc4, 0x88, 0x10, 0x1e, 0xe, 0xc8, 0x8, 0x8, 0xe, 0x10, 0x8, 0x4, 0x82, 0x41, 0xe, 0xc2, 0x42, 0x42, 0x4e, 0x4, 0x8a, 0x40, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1f, 0x8, 0x4, 0x80, 0x0, 0x0, 0x0, 0xe, 0xd2, 0x52, 0x4f, 0x10, 0x10, 0x1c, 0x92, 0x5c, 0x0, 0xe, 0xd0, 0x10, 0xe, 0x2, 0x42, 0x4e, 0xd2, 0x4e, 0xc, 0x92, 0x5c, 0x90, 0xe, 0x6, 0xc8, 0x1c, 0x88, 0x8, 0xe, 0xd2, 0x4e, 0xc2, 0x4c, 0x10, 0x10, 0x1c, 0x92, 0x52, 0x8, 0x0, 0x8, 0x8, 0x8, 0x2, 0x40, 0x2, 0x42, 0x4c, 0x10, 0x14, 0x98, 0x14, 0x92, 0x8, 0x8, 0x8, 0x8, 0x6, 0x0, 0x1b, 0x75, 0xb1, 0x31, 0x0, 0x1c, 0x92, 0x52, 0x52, 0x0, 0xc, 0x92, 0x52, 0x4c, 0x0, 0x1c, 0x92, 0x5c, 0x90, 0x0, 0xe, 0xd2, 0x4e, 0xc2, 0x0, 0xe, 0xd0, 0x10, 0x10, 0x0, 0x6, 0xc8, 0x4, 0x98, 0x8, 0x8, 0xe, 0xc8, 0x7, 0x0, 0x12, 0x52, 0x52, 0x4f, 0x0, 0x11, 0x31, 0x2a, 0x44, 0x0, 0x11, 0x31, 0x35, 0xbb, 0x0, 0x12, 0x4c, 0x8c, 0x92, 0x0, 0x11, 0x2a, 0x44, 0x98, 0x0, 0x1e, 0xc4, 0x88, 0x1e, 0x6, 0xc4, 0x8c, 0x84, 0x86, 0x8, 0x8, 0x8, 0x8, 0x8, 0x18, 0x8, 0xc, 0x88, 0x18, 0x0, 0x0, 0xc, 0x83, 0x60];
function createFont(): Image {
    let nb = FONT_DATA.length;
    let n = nb / 5;
    let font = createInternalImage(nb);
    for (let c = 0; c < n; c++) {
        for (let row = 0; row < 5; row++) {
            let char = FONT_DATA[c * 5 + row];
            for (let col = 0; col < 5; col++) {
                if ((char & (1 << col)) != 0)
                    font.set((c * 5 + 4) - col, row, 255);
            }
        }
    }
    return font;
}

const textToPixels = (text: string) => {
    let font = createFont();
    let w = font.width;
    let sprite = createInternalImage(6 * text.length - 1);
    let k = 0;
    for (let i = 0; i < text.length; i++) {
        let charCode = text.charCodeAt(i);
        let charStart = (charCode - 32) * 5;
        if (charStart < 0 || charStart + 5 > w) {
            charCode = " ".charCodeAt(0);
            charStart = (charCode - 32) * 5;
        }

        font.copyTo(charStart, 5, sprite, k);
        k = k + 5;
        if (i < text.length - 1) {
            k = k + 1;
        }
    }
    return sprite;
}


export default textToPixels