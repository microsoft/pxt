<!doctype html>
<html lang="en" data-manifest="" data-framework="typescript">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,height=device-height,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0" />
    <style>
        @import "/blb/semantic.css";

        body {
            display: flex;
            flex-direction: column;
        }

        #logsouter {
            width: 100%;
            height: 10rem;
            border: 0;
            font-size: 0.6rem;
            overflow-y: auto;
        }

        #logs img {
            max-width:18rem;
        }

        #iframe {
            border: 0;
            flex-grow: 1;
        }

        .ui.buttons {
            flex-wrap: wrap;
        }
    </style>
    <script>
        var projects = [];
        var offline = false;
        restoreFromLocalStore();

        function sendMessage(msg) {
            console.log('send', msg)
            appendToLog(`> ${msg.resp.statusCode}`)
            var editor = document.getElementById("iframe").contentWindow;
            editor.postMessage(msg, "*")
        }

        function appendToLog(msg) {
            var logs = document.getElementById("logs");
            logs.innerText += msg + "\n";
            logs.parentElement.scrollTop = logs.parentElement.scrollHeight;
        }

        function saveToLocalStore() {
            localStorage["CLOUD_FRAME_TEST"] = JSON.stringify(projects);
        }

        function restoreFromLocalStore() {
            const stored = localStorage["CLOUD_FRAME_TEST"];
            if (stored) {
                projects = JSON.parse(stored);
            }
        }

        function receiveMessage(ev) {
            var editor = document.getElementById("iframe").contentWindow;
            var msg = ev.data;
            console.log('received...')
            console.log(msg)

            if (msg.action !== "cloudproxy") return;

            if (offline) {
                sendMessage({
                    type: "pxteditor",
                    action: "cloudproxy",
                    operation: msg.operation,
                    id: msg.id,
                    success: false,
                    resp: {
                        resp: undefined,
                        statusCode: 503,
                        success: false,
                        err: "offline"
                    }
                });
                return;
            }

            if (msg.operation === "user") {
                appendToLog("GET USER");
                sendMessage({
                    type: "pxteditor",
                    action: "cloudproxy",
                    operation: "user",
                    id: msg.id,
                    success: true,
                    resp: {
                        resp: { id: "cloud-proxy-test" },
                        statusCode: 200,
                        success: true,
                        err: undefined
                    }
                });
            }
            else if (msg.operation === "list") {
                appendToLog("LIST PROJECTS: [" + projects.map(p => p.id).join(", ") + "]");
                sendMessage({
                    type: "pxteditor",
                    action: "cloudproxy",
                    operation: "list",
                    id: msg.id,
                    success: true,
                    resp: {
                        resp: projects.slice(),
                        statusCode: 200,
                        success: true,
                        err: undefined
                    }
                });
            }
            else if (msg.operation === "get") {
                appendToLog("GET: " + msg.headerId);

                const existing = projects.find(p => p.id === msg.headerId);
                if (existing) {
                    sendMessage({
                        type: "pxteditor",
                        action: "cloudproxy",
                        operation: "get",
                        id: msg.id,
                        success: true,
                        resp: {
                            resp: existing,
                            statusCode: 200,
                            success: true,
                            err: undefined
                        }
                    });
                }
                else {
                    sendMessage({
                        type: "pxteditor",
                        action: "cloudproxy",
                        operation: "get",
                        id: msg.id,
                        success: true,
                        resp: {
                            statusCode: 404,
                            success: false,
                            err: undefined
                        }
                    });
                }
            }
            else if (msg.operation === "set") {
                appendToLog("SET: " + msg.project.id);

                const existingIndex = projects.findIndex(p => p.id === msg.project.id);
                const existing = projects[existingIndex];
                if (existing) {
                    if (existing.version !== msg.project.version) {
                        // conflict
                        appendToLog("CONFLICT");
                        sendMessage({
                            type: "pxteditor",
                            action: "cloudproxy",
                            operation: "list",
                            id: msg.id,
                            success: true,
                            resp: {
                                statusCode: 409,
                                success: false,
                                err: "conflict"
                            }
                        });
                    }
                    else {
                        const newProject = {
                            ...msg.project,
                            version: Math.random().toString()
                        }
                        projects.splice(existingIndex, 1, newProject);
                        saveToLocalStore();

                        sendMessage({
                            type: "pxteditor",
                            action: "cloudproxy",
                            operation: "list",
                            id: msg.id,
                            success: true,
                            resp: {
                                resp: newProject.version,
                                statusCode: 200,
                                success: true,
                                err: undefined
                            }
                        });
                    }
                }
                else {
                    const newProject = {
                        ...msg.project,
                        version: Math.random().toString()
                    };
                    projects.push(newProject)
                    saveToLocalStore();

                    sendMessage({
                        type: "pxteditor",
                        action: "cloudproxy",
                        operation: "list",
                        id: msg.id,
                        success: true,
                        resp: {
                            resp: newProject.version,
                            statusCode: 200,
                            success: true,
                            err: undefined
                        }
                    });
                }
            }
        }

        window.addEventListener("message", receiveMessage, false);

        window.addEventListener("DOMContentLoaded", () => {
            document.getElementById("addproject").addEventListener("click", () => {
                const projectTemplate = '{"id":"0d8e576b-e950-4046-fe91-c4806880e4c7","header":"{\\"name\\":\\"Untitled\\",\\"meta\\":{},\\"editor\\":\\"blocksprj\\",\\"pubId\\":\\"\\",\\"pubCurrent\\":false,\\"target\\":\\"minecraft\\",\\"targetVersion\\":\\"2.0.27\\",\\"id\\":\\"0d8e576b-e950-4046-fe91-c4806880e4c7\\",\\"recentUse\\":1732215637,\\"modificationTime\\":1732215637,\\"path\\":\\"Untitled-15\\",\\"saveId\\":null,\\"githubCurrent\\":false,\\"cloudUserId\\":\\"cloud-proxy-test\\"}","text":"{\\"README.md\\":\\"\\",\\"main.blocks\\":\\"<xml xmlns=\\\\\\"https://developers.google.com/blockly/xml\\\\\\"><variables></variables><block type=\\\\\\"pxt-on-start\\\\\\" x=\\\\\\"0\\\\\\" y=\\\\\\"0\\\\\\"></block><block type=\\\\\\"minecraftOnChat\\\\\\" x=\\\\\\"373\\\\\\" y=\\\\\\"157\\\\\\"><mutation xmlns=\\\\\\"http://www.w3.org/1999/xhtml\\\\\\" numargs=\\\\\\"0\\\\\\"></mutation><value name=\\\\\\"command\\\\\\"><shadow type=\\\\\\"text\\\\\\"><field name=\\\\\\"TEXT\\\\\\">run</field></shadow></value></block></xml>\\",\\"main.ts\\":\\"player.onChat(\\\\\\"run\\\\\\", function () {\\\\n\\\\t\\\\n})\\\\n\\",\\"pxt.json\\":\\"{\\\\n    \\\\\\"name\\\\\\": \\\\\\"Untitled\\\\\\",\\\\n    \\\\\\"description\\\\\\": \\\\\\"\\\\\\",\\\\n    \\\\\\"dependencies\\\\\\": {\\\\n        \\\\\\"core\\\\\\": \\\\\\"*\\\\\\",\\\\n        \\\\\\"builder\\\\\\": \\\\\\"*\\\\\\"\\\\n    },\\\\n    \\\\\\"files\\\\\\": [\\\\n        \\\\\\"main.blocks\\\\\\",\\\\n        \\\\\\"main.ts\\\\\\",\\\\n        \\\\\\"README.md\\\\\\"\\\\n    ],\\\\n    \\\\\\"preferredEditor\\\\\\": \\\\\\"blocksprj\\\\\\"\\\\n}\\\\n\\",\\"_history\\":\\"{\\\\\\"entries\\\\\\":[{\\\\\\"timestamp\\\\\\":1732142759533,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\"http\\\\\\"],[-1,\\\\\\"s\\\\\\"],[0,\\\\\\"://\\\\\\"],[-1,\\\\\\"developers.google.com/blockly/xml\\\\\\\\\\\\\\"><variables></variables>\\\\\\"],[1,\\\\\\"www.w3.org/1999/xhtml\\\\\\\\\\\\\\">\\\\\\\\n  \\\\\\"],[0,\\\\\\"<blo\\\\\\"]],\\\\\\"start1\\\\\\":12,\\\\\\"start2\\\\\\":12,\\\\\\"length1\\\\\\":70,\\\\\\"length2\\\\\\":37},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"art\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\" x=\\\\\\\\\\\\\\"13\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"11\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\"></b\\\\\\"]],\\\\\\"start1\\\\\\":67,\\\\\\"start2\\\\\\":67,\\\\\\"length1\\\\\\":22,\\\\\\"length2\\\\\\":8},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"</block>\\\\\\"],[1,\\\\\\"\\\\\\\\n  \\\\\\"],[0,\\\\\\"<block t\\\\\\"]],\\\\\\"start1\\\\\\":72,\\\\\\"start2\\\\\\":72,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":19},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"hat\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\" x=\\\\\\\\\\\\\\"225\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"20\\\\\\\\\\\\\\"><mutation xmlns=\\\\\\\\\\\\\\"http://www.w3.org/1999/xhtml\\\\\\\\\\\\\\" numargs=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\"></mutation>\\\\\\"],[1,\\\\\\">\\\\\\\\n    \\\\\\"],[0,\\\\\\"<val\\\\\\"]],\\\\\\"start1\\\\\\":108,\\\\\\"start2\\\\\\":108,\\\\\\"length1\\\\\\":94,\\\\\\"length2\\\\\\":14},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"ommand\\\\\\\\\\\\\\">\\\\\\"],[1,\\\\\\"\\\\\\\\n      \\\\\\"],[0,\\\\\\"<shadow \\\\\\"]],\\\\\\"start1\\\\\\":132,\\\\\\"start2\\\\\\":132,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":23},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"=\\\\\\\\\\\\\\"text\\\\\\\\\\\\\\">\\\\\\"],[1,\\\\\\"\\\\\\\\n        \\\\\\"],[0,\\\\\\"<field n\\\\\\"]],\\\\\\"start1\\\\\\":159,\\\\\\"start2\\\\\\":159,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":25},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"</field>\\\\\\"],[1,\\\\\\"\\\\\\\\n      \\\\\\"],[0,\\\\\\"</shadow\\\\\\"]],\\\\\\"start1\\\\\\":198,\\\\\\"start2\\\\\\":198,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":23},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"dow>\\\\\\"],[1,\\\\\\"\\\\\\\\n    \\\\\\"],[0,\\\\\\"</value>\\\\\\"],[1,\\\\\\"\\\\\\\\n  \\\\\\"],[0,\\\\\\"</block>\\\\\\"],[1,\\\\\\"\\\\\\\\n\\\\\\"],[0,\\\\\\"</xm\\\\\\"]],\\\\\\"start1\\\\\\":218,\\\\\\"start2\\\\\\":218,\\\\\\"length1\\\\\\":24,\\\\\\"length2\\\\\\":33}]},{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.ts\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[-1,\\\\\\"player.onChat(\\\\\\\\\\\\\\"run\\\\\\\\\\\\\\", function () {\\\\\\\\n\\\\\\\\t\\\\\\\\n})\\\\\\"],[0,\\\\\\"\\\\\\\\n\\\\\\"]],\\\\\\"start1\\\\\\":0,\\\\\\"start2\\\\\\":0,\\\\\\"length1\\\\\\":40,\\\\\\"length2\\\\\\":1}]},{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"pxt.json\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\"d\\\\\\\\\\\\\\"\\\\\\\\n    ]\\\\\\"],[1,\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"additionalFilePaths\\\\\\\\\\\\\\": []\\\\\\"],[0,\\\\\\"\\\\\\\\n}\\\\\\\\n\\\\\\"]],\\\\\\"start1\\\\\\":196,\\\\\\"start2\\\\\\":196,\\\\\\"length1\\\\\\":11,\\\\\\"length2\\\\\\":42}]}]},{\\\\\\"timestamp\\\\\\":1732142768049,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"0\\\\\\"],[1,\\\\\\"13\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"0\\\\\\"],[1,\\\\\\"11\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"></\\\\\\"]],\\\\\\"start1\\\\\\":104,\\\\\\"start2\\\\\\":104,\\\\\\"length1\\\\\\":15,\\\\\\"length2\\\\\\":17},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"x=\\\\\\\\\\\\\\"2\\\\\\"],[-1,\\\\\\"1\\\\\\"],[0,\\\\\\"2\\\\\\"],[1,\\\\\\"5\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"9\\\\\\"],[1,\\\\\\"20\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":157,\\\\\\"start2\\\\\\":157,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":17}]}]},{\\\\\\"timestamp\\\\\\":1732143071860,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"403\\\\\\"],[1,\\\\\\"212\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"161\\\\\\"],[1,\\\\\\"9\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":19,\\\\\\"length2\\\\\\":17}]}]},{\\\\\\"timestamp\\\\\\":1732143073108,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"365\\\\\\"],[1,\\\\\\"403\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"217\\\\\\"],[1,\\\\\\"161\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":19,\\\\\\"length2\\\\\\":19}]}]},{\\\\\\"timestamp\\\\\\":1732144189521,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"pxt.json\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\"   ]\\\\\\"],[-1,\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"preferredEditor\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"blocksprj\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\"\\\\\\\\n}\\\\\\\\n\\\\\\"]],\\\\\\"start1\\\\\\":200,\\\\\\"start2\\\\\\":200,\\\\\\"length1\\\\\\":43,\\\\\\"length2\\\\\\":7}]}]},{\\\\\\"timestamp\\\\\\":1732144212745,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"556\\\\\\"],[1,\\\\\\"365\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"180\\\\\\"],[1,\\\\\\"217\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":19,\\\\\\"length2\\\\\\":19}]}]},{\\\\\\"timestamp\\\\\\":1732144365152,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"358\\\\\\"],[1,\\\\\\"556\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"1\\\\\\"],[-1,\\\\\\"0\\\\\\"],[1,\\\\\\"8\\\\\\"],[0,\\\\\\"0\\\\\\\\\\\\\\"><\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":18,\\\\\\"length2\\\\\\":18}]}]},{\\\\\\"timestamp\\\\\\":1732144698791,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"73\\\\\\"],[1,\\\\\\"0\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"2\\\\\\"],[0,\\\\\\"0\\\\\\\\\\\\\\"><\\\\\\"]],\\\\\\"start1\\\\\\":104,\\\\\\"start2\\\\\\":104,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":14},{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"274\\\\\\"],[1,\\\\\\"358\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"1\\\\\\"],[-1,\\\\\\"79\\\\\\"],[1,\\\\\\"00\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":19,\\\\\\"length2\\\\\\":19}]}]},{\\\\\\"timestamp\\\\\\":1732144746926,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"0\\\\\\"],[1,\\\\\\"73\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[1,\\\\\\"2\\\\\\"],[0,\\\\\\"0\\\\\\\\\\\\\\"><\\\\\\"]],\\\\\\"start1\\\\\\":104,\\\\\\"start2\\\\\\":104,\\\\\\"length1\\\\\\":14,\\\\\\"length2\\\\\\":16},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"x=\\\\\\\\\\\\\\"2\\\\\\"],[-1,\\\\\\"01\\\\\\"],[1,\\\\\\"74\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"1\\\\\\"],[-1,\\\\\\"5\\\\\\"],[1,\\\\\\"7\\\\\\"],[0,\\\\\\"9\\\\\\\\\\\\\\"><\\\\\\"]],\\\\\\"start1\\\\\\":157,\\\\\\"start2\\\\\\":157,\\\\\\"length1\\\\\\":17,\\\\\\"length2\\\\\\":17}]}]},{\\\\\\"timestamp\\\\\\":1732146384256,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"417\\\\\\"],[1,\\\\\\"201\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"1\\\\\\"],[-1,\\\\\\"6\\\\\\"],[0,\\\\\\"5\\\\\\"],[1,\\\\\\"9\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":19,\\\\\\"length2\\\\\\":19}]}]},{\\\\\\"timestamp\\\\\\":1732146385919,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"306\\\\\\"],[1,\\\\\\"417\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[1,\\\\\\"16\\\\\\"],[0,\\\\\\"5\\\\\\"],[-1,\\\\\\"7\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\"><m\\\\\\"]],\\\\\\"start1\\\\\\":154,\\\\\\"start2\\\\\\":154,\\\\\\"length1\\\\\\":18,\\\\\\"length2\\\\\\":19}]}]},{\\\\\\"timestamp\\\\\\":1732146683696,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.27\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\"art\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\" id=\\\\\\\\\\\\\\".RhLIu7|D3bQOiWe9|dx\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"]],\\\\\\"start1\\\\\\":100,\\\\\\"start2\\\\\\":100,\\\\\\"length1\\\\\\":34,\\\\\\"length2\\\\\\":8},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"hat\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\" id=\\\\\\\\\\\\\\"0YnLaj,v6)?Y[/.inFDW\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\" x=\\\\\\\\\\\\\\"\\\\\\"]],\\\\\\"start1\\\\\\":150,\\\\\\"start2\\\\\\":150,\\\\\\"length1\\\\\\":34,\\\\\\"length2\\\\\\":8},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"ext\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\" id=\\\\\\\\\\\\\\"*4i}6GFDmU(N|WYZSgkd\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\"><fi\\\\\\"]],\\\\\\"start1\\\\\\":277,\\\\\\"start2\\\\\\":277,\\\\\\"length1\\\\\\":34,\\\\\\"length2\\\\\\":8}]}]},{\\\\\\"timestamp\\\\\\":1732215635103,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.27\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\"n-start\\\\\\\\\\\\\\"\\\\\\"],[1,\\\\\\" id=\\\\\\\\\\\\\\".RhLIu7|D3bQOiWe9|dx\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\" x=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\" y\\\\\\"]],\\\\\\"start1\\\\\\":96,\\\\\\"start2\\\\\\":96,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":42},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"tOnChat\\\\\\\\\\\\\\"\\\\\\"],[1,\\\\\\" id=\\\\\\\\\\\\\\"0YnLaj,v6)?Y[/.inFDW\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\" x=\\\\\\\\\\\\\\"306\\\\\\\\\\\\\\"\\\\\\"]],\\\\\\"start1\\\\\\":172,\\\\\\"start2\\\\\\":172,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":42},{\\\\\\"diffs\\\\\\":[[0,\\\\\\"e=\\\\\\\\\\\\\\"text\\\\\\\\\\\\\\"\\\\\\"],[1,\\\\\\" id=\\\\\\\\\\\\\\"*4i}6GFDmU(N|WYZSgkd\\\\\\\\\\\\\\"\\\\\\"],[0,\\\\\\"><field \\\\\\"]],\\\\\\"start1\\\\\\":325,\\\\\\"start2\\\\\\":325,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":42}]}]},{\\\\\\"timestamp\\\\\\":1732215636091,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.27\\\\\\",\\\\\\"changes\\\\\\":[{\\\\\\"type\\\\\\":\\\\\\"edited\\\\\\",\\\\\\"filename\\\\\\":\\\\\\"main.blocks\\\\\\",\\\\\\"patch\\\\\\":[{\\\\\\"diffs\\\\\\":[[0,\\\\\\"x=\\\\\\\\\\\\\\"3\\\\\\"],[-1,\\\\\\"73\\\\\\"],[1,\\\\\\"06\\\\\\"],[0,\\\\\\"\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"\\\\\\"],[-1,\\\\\\"1\\\\\\"],[0,\\\\\\"57\\\\\\\\\\\\\\">\\\\\\"]],\\\\\\"start1\\\\\\":155,\\\\\\"start2\\\\\\":155,\\\\\\"length1\\\\\\":16,\\\\\\"length2\\\\\\":15}]}]}],\\\\\\"snapshots\\\\\\":[{\\\\\\"timestamp\\\\\\":1732142759532,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"text\\\\\\":{\\\\\\"main.blocks\\\\\\":\\\\\\"<xml xmlns=\\\\\\\\\\\\\\"http://www.w3.org/1999/xhtml\\\\\\\\\\\\\\">\\\\\\\\n  <block type=\\\\\\\\\\\\\\"pxt-on-start\\\\\\\\\\\\\\"></block>\\\\\\\\n  <block type=\\\\\\\\\\\\\\"minecraftOnChat\\\\\\\\\\\\\\">\\\\\\\\n    <value name=\\\\\\\\\\\\\\"command\\\\\\\\\\\\\\">\\\\\\\\n      <shadow type=\\\\\\\\\\\\\\"text\\\\\\\\\\\\\\">\\\\\\\\n        <field name=\\\\\\\\\\\\\\"TEXT\\\\\\\\\\\\\\">run</field>\\\\\\\\n      </shadow>\\\\\\\\n    </value>\\\\\\\\n  </block>\\\\\\\\n</xml>\\\\\\",\\\\\\"main.ts\\\\\\":\\\\\\"\\\\\\\\n\\\\\\",\\\\\\"README.md\\\\\\":\\\\\\"\\\\\\",\\\\\\"pxt.json\\\\\\":\\\\\\"{\\\\\\\\n    \\\\\\\\\\\\\\"name\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"Untitled\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"description\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"dependencies\\\\\\\\\\\\\\": {\\\\\\\\n        \\\\\\\\\\\\\\"core\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"builder\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\"\\\\\\\\n    },\\\\\\\\n    \\\\\\\\\\\\\\"files\\\\\\\\\\\\\\": [\\\\\\\\n        \\\\\\\\\\\\\\"main.blocks\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"main.ts\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"README.md\\\\\\\\\\\\\\"\\\\\\\\n    ],\\\\\\\\n    \\\\\\\\\\\\\\"additionalFilePaths\\\\\\\\\\\\\\": []\\\\\\\\n}\\\\\\\\n\\\\\\"}},{\\\\\\"timestamp\\\\\\":1732144189521,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"text\\\\\\":{\\\\\\"main.blocks\\\\\\":\\\\\\"<xml xmlns=\\\\\\\\\\\\\\"https://developers.google.com/blockly/xml\\\\\\\\\\\\\\"><variables></variables><block type=\\\\\\\\\\\\\\"pxt-on-start\\\\\\\\\\\\\\" x=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\"></block><block type=\\\\\\\\\\\\\\"minecraftOnChat\\\\\\\\\\\\\\" x=\\\\\\\\\\\\\\"403\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"161\\\\\\\\\\\\\\"><mutation xmlns=\\\\\\\\\\\\\\"http://www.w3.org/1999/xhtml\\\\\\\\\\\\\\" numargs=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\"></mutation><value name=\\\\\\\\\\\\\\"command\\\\\\\\\\\\\\"><shadow type=\\\\\\\\\\\\\\"text\\\\\\\\\\\\\\"><field name=\\\\\\\\\\\\\\"TEXT\\\\\\\\\\\\\\">run</field></shadow></value></block></xml>\\\\\\",\\\\\\"main.ts\\\\\\":\\\\\\"player.onChat(\\\\\\\\\\\\\\"run\\\\\\\\\\\\\\", function () {\\\\\\\\n\\\\\\\\t\\\\\\\\n})\\\\\\\\n\\\\\\",\\\\\\"README.md\\\\\\":\\\\\\"\\\\\\",\\\\\\"pxt.json\\\\\\":\\\\\\"{\\\\\\\\n    \\\\\\\\\\\\\\"name\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"Untitled\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"description\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"dependencies\\\\\\\\\\\\\\": {\\\\\\\\n        \\\\\\\\\\\\\\"core\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"builder\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\"\\\\\\\\n    },\\\\\\\\n    \\\\\\\\\\\\\\"files\\\\\\\\\\\\\\": [\\\\\\\\n        \\\\\\\\\\\\\\"main.blocks\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"main.ts\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"README.md\\\\\\\\\\\\\\"\\\\\\\\n    ]\\\\\\\\n}\\\\\\\\n\\\\\\"}},{\\\\\\"timestamp\\\\\\":1732146384256,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.21\\\\\\",\\\\\\"text\\\\\\":{\\\\\\"main.blocks\\\\\\":\\\\\\"<xml xmlns=\\\\\\\\\\\\\\"https://developers.google.com/blockly/xml\\\\\\\\\\\\\\"><variables></variables><block type=\\\\\\\\\\\\\\"pxt-on-start\\\\\\\\\\\\\\" x=\\\\\\\\\\\\\\"73\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"20\\\\\\\\\\\\\\"></block><block type=\\\\\\\\\\\\\\"minecraftOnChat\\\\\\\\\\\\\\" x=\\\\\\\\\\\\\\"274\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"179\\\\\\\\\\\\\\"><mutation xmlns=\\\\\\\\\\\\\\"http://www.w3.org/1999/xhtml\\\\\\\\\\\\\\" numargs=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\"></mutation><value name=\\\\\\\\\\\\\\"command\\\\\\\\\\\\\\"><shadow type=\\\\\\\\\\\\\\"text\\\\\\\\\\\\\\"><field name=\\\\\\\\\\\\\\"TEXT\\\\\\\\\\\\\\">run</field></shadow></value></block></xml>\\\\\\",\\\\\\"main.ts\\\\\\":\\\\\\"\\\\\\",\\\\\\"README.md\\\\\\":\\\\\\"\\\\\\",\\\\\\"pxt.json\\\\\\":\\\\\\"{\\\\\\\\n    \\\\\\\\\\\\\\"name\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"Untitled\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"description\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"dependencies\\\\\\\\\\\\\\": {\\\\\\\\n        \\\\\\\\\\\\\\"core\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"builder\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\"\\\\\\\\n    },\\\\\\\\n    \\\\\\\\\\\\\\"files\\\\\\\\\\\\\\": [\\\\\\\\n        \\\\\\\\\\\\\\"main.blocks\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"main.ts\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"README.md\\\\\\\\\\\\\\"\\\\\\\\n    ],\\\\\\\\n    \\\\\\\\\\\\\\"preferredEditor\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"blocksprj\\\\\\\\\\\\\\"\\\\\\\\n}\\\\\\\\n\\\\\\"}},{\\\\\\"timestamp\\\\\\":1732215635103,\\\\\\"editorVersion\\\\\\":\\\\\\"2.0.27\\\\\\",\\\\\\"text\\\\\\":{\\\\\\"main.blocks\\\\\\":\\\\\\"<xml xmlns=\\\\\\\\\\\\\\"https://developers.google.com/blockly/xml\\\\\\\\\\\\\\"><variables></variables><block type=\\\\\\\\\\\\\\"pxt-on-start\\\\\\\\\\\\\\" x=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\"></block><block type=\\\\\\\\\\\\\\"minecraftOnChat\\\\\\\\\\\\\\" x=\\\\\\\\\\\\\\"306\\\\\\\\\\\\\\" y=\\\\\\\\\\\\\\"57\\\\\\\\\\\\\\"><mutation xmlns=\\\\\\\\\\\\\\"http://www.w3.org/1999/xhtml\\\\\\\\\\\\\\" numargs=\\\\\\\\\\\\\\"0\\\\\\\\\\\\\\"></mutation><value name=\\\\\\\\\\\\\\"command\\\\\\\\\\\\\\"><shadow type=\\\\\\\\\\\\\\"text\\\\\\\\\\\\\\"><field name=\\\\\\\\\\\\\\"TEXT\\\\\\\\\\\\\\">run</field></shadow></value></block></xml>\\\\\\",\\\\\\"main.ts\\\\\\":\\\\\\"\\\\\\",\\\\\\"README.md\\\\\\":\\\\\\"\\\\\\",\\\\\\"pxt.json\\\\\\":\\\\\\"{\\\\\\\\n    \\\\\\\\\\\\\\"name\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"Untitled\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"description\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"\\\\\\\\\\\\\\",\\\\\\\\n    \\\\\\\\\\\\\\"dependencies\\\\\\\\\\\\\\": {\\\\\\\\n        \\\\\\\\\\\\\\"core\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"builder\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"*\\\\\\\\\\\\\\"\\\\\\\\n    },\\\\\\\\n    \\\\\\\\\\\\\\"files\\\\\\\\\\\\\\": [\\\\\\\\n        \\\\\\\\\\\\\\"main.blocks\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"main.ts\\\\\\\\\\\\\\",\\\\\\\\n        \\\\\\\\\\\\\\"README.md\\\\\\\\\\\\\\"\\\\\\\\n    ],\\\\\\\\n    \\\\\\\\\\\\\\"preferredEditor\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"blocksprj\\\\\\\\\\\\\\"\\\\\\\\n}\\\\\\\\n\\\\\\"}}],\\\\\\"shares\\\\\\":[],\\\\\\"lastSaveTime\\\\\\":1732215637268}\\"}","version":"0.7292567282910232"}';

                const parsed = JSON.parse(projectTemplate);
                const id = crypto.randomUUID();
                parsed.id = id;

                const header = JSON.parse(parsed.header);
                header.id = id;
                header.name = id;
                header.path = id;

                parsed.header = JSON.stringify(header);

                const text = JSON.parse(parsed.text);
                const config = JSON.parse(text["pxt.json"]);
                config.name = id;
                text["pxt.json"] = JSON.stringify(config, null, 4);
                parsed.text = JSON.stringify(text);

                parsed.version = crypto.randomUUID();

                projects.push(parsed);
                saveToLocalStore();
            });

            document.getElementById("deleteprojects").addEventListener("click", () => {
                projects = [];
                saveToLocalStore();
            });

            var toggle = document.getElementById("toggleoffline");
            toggle.addEventListener("click", () => {
                offline = !offline;

                if (offline) {
                    toggle.textContent = "Go online"
                }
                else {
                    toggle.textContent = "Go offline"
                }
            });
        })

    </script>
</head>
<body>
    <div style="display: flex;">
        <button id="addproject">Add cloud project</button>
        <button id="deleteprojects">Delete cloud projects</button>
        <button id="toggleoffline">Go offline</button>
    </div>
    <div id="logsouter">
        <pre id="logs" class="ui"></pre>
    </div>
    <iframe id="iframe" src="index.html?ipc=1&inGame=1&nosandbox=1"></iframe>
</body>

</html>
