/* Import all components */
@import "themes/default/globals/site.variables";
@import "themes/pxt/globals/site.variables";

/* Reference import */
@import (reference) "semantic.less";

/*******************************
         Side docs
*******************************/

/* Side Docs layout */
#sidedocs {
    top: 0;
    right: 0;
    width: 0;
    z-index: @sidedocZIndex;
    visibility: hidden;
    opacity: 0;
    /* Animate width/right/opacity so the side panel transitions with the same timing as the tabs */
    transition: width 0.25s ease, right 0.25s ease, opacity 0.25s ease;
}

#sidedocsbar {
    position: absolute;
    right: 1rem;
}

#sidedocsframe {
    width: 0;
    height: 0;
    border: none;
    background: white;
}

code.hljs {
    background: none;
}

/* Side docs - expanded state */
.sideDocs {
    /* Define the default width value for use by the panel and the tabstrip */
    --sidedocWidth:~"min(@{sideBarWidth}, 50vw)";

    /* Use user-set width (in vw) if available, otherwise use default */
    --effectiveWidth: var(--sidedoc-user-width, var(--sidedocWidth));

    #sidedocs {
        position: fixed;
        visibility: visible;
        opacity: 1;
        width: var(--effectiveWidth);
        /* Don't let the panel expand beyond a fraction of the viewport */
        max-width: 60vw;
        min-width: 20vw;
        top: calc(@mainMenuHeight + 1rem);
        height:~"calc(100% - @{mainMenuHeight} - @{editorToolsCollapsedHeight} - 2rem)";
    }

    #sidedocsframe-wrapper {
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
        width: var(--effectiveWidth);
        height: 100%;
        -webkit-box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.41);
        -moz-box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.41);
        box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.41);
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
        z-index: @sidedocZIndex;

        &:has(aside:focus-visible) {
            outline: @editorFocusBorderSize solid var(--pxt-focus-border);
        }
    }

    #sidedocsframe {
        width: 100%;
        height: 100%;
        border: none;
        background: white;
    }

    #sidedocsbar {
        top: 1rem;
        z-index: @sidedocZIndex+1;
    }

    /* Move the tab strip to the panel edge when sidebar is open */
    #sidedocstabs {
        right: var(--effectiveWidth);
        transition: right 0.25s ease;
    }
}

#sidedocsbar .ui.link .icon {
    cursor: pointer;
    font-size: @h3;
}

/* Sidedocs in Monaco editor */
.sideDocs.editorlang-text {
    #sidedocs {
        width: 50% !important;
        min-width: 18rem;
    }

    #sidedocsframe,
    #sidedocsframe-wrapper {
        width: 100% !important;
    }
}

/* Side docs tab strip styles */
#sidedocstabs,
.sidedoc-tablist {
    position: fixed;
    right: 0;
    top: calc(@mainMenuHeight + 12px);
    display: flex;
    flex-direction: column;
    z-index: @sidedocZIndex + 1;
    gap: 0.35rem;
    padding: 0.25rem;
    /* no transition by default (instant close on collapse) */
    transition: none;
}

.sidedoc-tab {
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.35rem;
    background: var(--pxt-neutral-alpha10);
    color: var(--pxt-neutral-foreground1);
    cursor: pointer;
    border: 1px solid transparent;

    &.active {
        background: var(--pxt-neutral-alpha20);
        border-color: var(--pxt-secondary-accent);
    }

    /* Make the inner button fill the tab wrapper */
    .ui.button {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        padding: 0;
        margin: 0;
        box-shadow: none;
    }
}

/* Header and content area styles */
#sidedocsframe-wrapper {
    .sidedoc-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.25rem;
        background: var(--pxt-header-background);
        color: var(--pxt-primary-foreground);
        z-index: @sidedocZIndex + 3;
        min-height: fit-content;

        .sidedoc-header-spacer {
            flex-grow: 1;
        }
    }

    .sidedoc-title {
        font-weight: 600;
        font-size: 1rem;
        line-height: 1;
        margin: 0;
    }

    /* content area below header */
    .sidedocs-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;

        /* iframe inside content area should flex to fill available space */
        #sidedocsframe {
            flex: 1;
            min-height: 0;
        }
    }
}

/* Resize handle styles */
.sidedocs-resize-handle {
    position: absolute;
    left: 0;
    top: 0;
    width: 4px;
    height: 100%;
    cursor: ew-resize;
    background: transparent;
    z-index: @sidedocZIndex + 2;

    /* Extended hit area for easier interaction */
    &::before {
        content: '';
        position: absolute;
        left: -2px;
        top: 0;
        width: 8px;
        height: 100%;
    }

    /* Visible indicator on hover/focus */
    &:hover,
    &:focus,
    &.resizing {
        background: var(--pxt-secondary-accent);
        outline: none;
    }

    &:focus-visible {
        outline: 2px solid var(--pxt-focus-border);
        outline-offset: 2px;
    }

    /* Suppress hover effects when another drag operation is active */
    &.drag-disabled {
        cursor: default;
        
        &:hover {
            background: transparent;
        }
    }

    /* Hide on mobile to avoid accidental touches */
    @media only screen and (max-width: @largestMobileScreen) {
        display: none;
    }
}

/* Body cursor changes during resize */
body.resizing-sidedocs {
    cursor: ew-resize !important;
    user-select: none !important;
    
    /* Disable transitions during resize for immediate feedback */
    #sidedocs,
    #sidedocsframe-wrapper {
        transition: none !important;
    }
}

/* High contrast support */
@media (prefers-contrast: high) {
    .sidedocs-resize-handle {
        &:hover,
        &:focus-visible,
        &.resizing,
        &:active {
            background: CanvasText;
        }
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .sidedocs-resize-handle {
        transition: none;
    }
}

/* Media Queries */
@media only screen and (min-width: @largeMonitorBreakpoint) {
    .sideDocs {
        --sidedocWidth:~"min(@{sideBarWidthLarge}, 50vw)";
        --effectiveWidth: var(--sidedoc-user-width, var(--sidedocWidth));
    }
}

@media only screen and (max-width: @largestMobileScreen) {
    .sideDocs {
        --sidedocWidth:~"min(@{sideBarWidthSmall}, 50vw)";
        --effectiveWidth: var(--sidedoc-user-width, var(--sidedocWidth));

        /* Disable resize on small screens */
        .sidedocs-resize-handle {
            display: none;
        }
    }

    #sidedocstabs,
    .sidedoc-tablist {
        top: calc(@mobileMenuHeight + 8px);
    }
}

@media only screen and (max-height: @tallEditorBreakpoint) and (min-width: @largestMobileScreen) {
    .sideDocs #sidedocs {
        top: calc(@thinMenuHeight + 1rem);
    }
}